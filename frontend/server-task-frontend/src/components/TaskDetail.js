"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const react_1 = require("react");
const uploadImage_1 = require("../utils/uploadImage");
const processImage_1 = require("../utils/processImage");
const API_BASE = 'https://u4e7e45gee.execute-api.ca-central-1.amazonaws.com/prod';
const TaskDetail = ({ taskId, userId }) => {
    const [task, setTask] = (0, react_1.useState)(null);
    const [editing, setEditing] = (0, react_1.useState)(false);
    const [saving, setSaving] = (0, react_1.useState)(false);
    const [message, setMessage] = (0, react_1.useState)(null);
    const [selectedFile, setSelectedFile] = (0, react_1.useState)(null);
    const [previewUrl, setPreviewUrl] = (0, react_1.useState)(null);
    const [labels, setLabels] = (0, react_1.useState)([]);
    (0, react_1.useEffect)(() => {
        fetch(`${API_BASE}/tasks`)
            .then(res => res.json())
            .then(data => {
            const found = data.find((t) => t.taskId === taskId && t.userId === userId);
            setTask(found);
        });
    }, [taskId, userId]);
    const handleChange = (e) => {
        setTask({ ...task, [e.target.name]: e.target.value });
    };
    const handleFileChange = (e) => {
        const file = e.target.files?.[0];
        if (file) {
            setSelectedFile(file);
            setPreviewUrl(URL.createObjectURL(file));
        }
    };
    const handleSave = async () => {
        setSaving(true);
        setMessage(null);
        try {
            // Update the task
            const res = await fetch(`${API_BASE}/tasks`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(task),
            });
            if (!res.ok)
                throw new Error('Failed to update task');
            const updatedTask = await res.json();
            // If file selected and pre-signed URL exists
            if (selectedFile && updatedTask.imageUploadUrl) {
                await (0, uploadImage_1.uploadImage)(updatedTask.imageUploadUrl, selectedFile);
                try {
                    const result = await (0, processImage_1.processImage)(updatedTask.taskId);
                    setLabels(result.labels.map((label) => label.Name));
                }
                catch (err) {
                    console.error('Error processing image:', err);
                }
            }
            setTask(updatedTask);
            setMessage('✅ Task updated successfully!');
            setEditing(false);
        }
        catch (err) {
            setMessage(`❌ ${err.message}`);
        }
        finally {
            setSaving(false);
        }
    };
    if (!task)
        return <p>Loading task...</p>;
    return (<div className="bg-white p-6 rounded shadow space-y-4">
      <div>
        <label className="font-semibold">Task ID:</label>
        <p>{task.taskId}</p>
      </div>

      <div>
        <label className="font-semibold">User ID:</label>
        <p>{task.userId}</p>
      </div>

      <div>
        <label className="font-semibold">Title:</label>
        {editing ? (<input name="title" value={task.title} onChange={handleChange} className="border p-2 w-full"/>) : (<p>{task.title}</p>)}
      </div>

      <div>
        <label className="font-semibold">Description:</label>
        {editing ? (<textarea name="description" value={task.description} onChange={handleChange} className="border p-2 w-full"/>) : (<p>{task.description}</p>)}
      </div>

      {editing && (<div className="space-y-2">
          <input type="file" accept="image/*" onChange={handleFileChange}/>
          {previewUrl && <img src={previewUrl} alt="Preview" className="w-48 rounded"/>}
        </div>)}

      {editing ? (<button onClick={handleSave} disabled={saving} className="bg-blue-600 text-white px-4 py-2 rounded">
          {saving ? 'Saving...' : 'Save'}
        </button>) : (<button onClick={() => setEditing(true)} className="bg-gray-300 text-black px-4 py-2 rounded">
          Edit
        </button>)}

      {message && <p className="text-sm mt-2">{message}</p>}

      {labels.length > 0 && (<div>
          <h3 className="font-semibold mt-4">Detected Labels:</h3>
          <ul className="list-disc ml-6 text-sm">
            {labels.map(label => <li key={label}>{label}</li>)}
          </ul>
        </div>)}
    </div>);
};
exports.default = TaskDetail;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGFza0RldGFpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlRhc2tEZXRhaWwudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaUNBQW1EO0FBQ25ELHNEQUFtRDtBQUNuRCx3REFBcUQ7QUFPckQsTUFBTSxRQUFRLEdBQUcsZ0VBQWdFLENBQUM7QUFFbEYsTUFBTSxVQUFVLEdBQThCLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRTtJQUNuRSxNQUFNLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBTSxJQUFJLENBQUMsQ0FBQztJQUM1QyxNQUFNLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxLQUFLLENBQUMsQ0FBQztJQUM5QyxNQUFNLENBQUMsTUFBTSxFQUFFLFNBQVMsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxLQUFLLENBQUMsQ0FBQztJQUM1QyxNQUFNLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBZ0IsSUFBSSxDQUFDLENBQUM7SUFDNUQsTUFBTSxDQUFDLFlBQVksRUFBRSxlQUFlLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQWMsSUFBSSxDQUFDLENBQUM7SUFDcEUsTUFBTSxDQUFDLFVBQVUsRUFBRSxhQUFhLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQWdCLElBQUksQ0FBQyxDQUFDO0lBQ2xFLE1BQU0sQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFXLEVBQUUsQ0FBQyxDQUFDO0lBRW5ELElBQUEsaUJBQVMsRUFBQyxHQUFHLEVBQUU7UUFDYixLQUFLLENBQUMsR0FBRyxRQUFRLFFBQVEsQ0FBQzthQUN2QixJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7YUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxF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TyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBRXJEOztNQUFBLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FDcEIsQ0FBQyxHQUFHLENBQ0Y7VUFBQSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsb0JBQW9CLENBQUMsZ0JBQWdCLEVBQUUsRUFBRSxDQUN2RDtVQUFBLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyx3QkFBd0IsQ0FDcEM7WUFBQSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQ3BEO1VBQUEsRUFBRSxFQUFFLENBQ047UUFBQSxFQUFFLEdBQUcsQ0FBQyxDQUNQLENBQ0g7SUFBQSxFQUFFLEdBQUcsQ0FBQyxDQUNQLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRixrQkFBZSxVQUFVLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHVwbG9hZEltYWdlIH0gZnJvbSAnLi4vdXRpbHMvdXBsb2FkSW1hZ2UnO1xuaW1wb3J0IHsgcHJvY2Vzc0ltYWdlIH0gZnJvbSAnLi4vdXRpbHMvcHJvY2Vzc0ltYWdlJztcblxuaW50ZXJmYWNlIFRhc2tEZXRhaWxQcm9wcyB7XG4gIHRhc2tJZDogc3RyaW5nO1xuICB1c2VySWQ6IHN0cmluZztcbn1cblxuY29uc3QgQVBJX0JBU0UgPSAnaHR0cHM6Ly91NGU3ZTQ1Z2VlLmV4ZWN1dGUtYXBpLmNhLWNlbnRyYWwtMS5hbWF6b25hd3MuY29tL3Byb2QnO1xuXG5jb25zdCBUYXNrRGV0YWlsOiBSZWFjdC5GQzxUYXNrRGV0YWlsUHJvcHM+ID0gKHsgdGFza0lkLCB1c2VySWQgfSkgPT4ge1xuICBjb25zdCBbdGFzaywgc2V0VGFza10gPSB1c2VTdGF0ZTxhbnk+KG51bGwpO1xuICBjb25zdCBbZWRpdGluZywgc2V0RWRpdGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtzYXZpbmcsIHNldFNhdmluZ10gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFttZXNzYWdlLCBzZXRNZXNzYWdlXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xuICBjb25zdCBbc2VsZWN0ZWRGaWxlLCBzZXRTZWxlY3RlZEZpbGVdID0gdXNlU3RhdGU8RmlsZSB8IG51bGw+KG51bGwpO1xuICBjb25zdCBbcHJldmlld1VybCwgc2V0UHJldmlld1VybF0gPSB1c2VTdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTtcbiAgY29uc3QgW2xhYmVscywgc2V0TGFiZWxzXSA9IHVzZVN0YXRlPHN0cmluZ1tdPihbXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBmZXRjaChgJHtBUElfQkFTRX0vdGFza3NgKVxuICAgICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXG4gICAgICAudGhlbihkYXRhID0+IHtcbiAgICAgICAgY29uc3QgZm91bmQgPSBkYXRhLmZpbmQoKHQ6IGFueSkgPT4gdC50YXNrSWQgPT09IHRhc2tJZCAmJiB0LnVzZXJJZCA9PT0gdXNlcklkKTtcbiAgICAgICAgc2V0VGFzayhmb3VuZCk7XG4gICAgICB9KTtcbiAgfSwgW3Rhc2tJZCwgdXNlcklkXSk7XG5cbiAgY29uc3QgaGFuZGxlQ2hhbmdlID0gKGU6IFJlYWN0LkNoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQgfCBIVE1MVGV4dEFyZWFFbGVtZW50PikgPT4ge1xuICAgIHNldFRhc2soeyAuLi50YXNrLCBbZS50YXJnZXQubmFtZV06IGUudGFyZ2V0LnZhbHVlIH0pO1xuICB9O1xuXG4gIGNvbnN0IGhhbmRsZUZpbGVDaGFuZ2UgPSAoZTogUmVhY3QuQ2hhbmdlRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICBjb25zdCBmaWxlID0gZS50YXJnZXQuZmlsZXM/LlswXTtcbiAgICBpZiAoZmlsZSkge1xuICAgICAgc2V0U2VsZWN0ZWRGaWxlKGZpbGUpO1xuICAgICAgc2V0UHJldmlld1VybChVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgaGFuZGxlU2F2ZSA9IGFzeW5jICgpID0+IHtcbiAgICBzZXRTYXZpbmcodHJ1ZSk7XG4gICAgc2V0TWVzc2FnZShudWxsKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBVcGRhdGUgdGhlIHRhc2tcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFfS90YXNrc2AsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh0YXNrKSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gdXBkYXRlIHRhc2snKTtcbiAgICAgIGNvbnN0IHVwZGF0ZWRUYXNrID0gYXdhaXQgcmVzLmpzb24oKTtcblxuICAgICAgLy8gSWYgZmlsZSBzZWxlY3RlZCBhbmQgcHJlLXNpZ25lZCBVUkwgZXhpc3RzXG4gICAgICBpZiAoc2VsZWN0ZWRGaWxlICYmIHVwZGF0ZWRUYXNrLmltYWdlVXBsb2FkVXJsKSB7XG4gICAgICAgIGF3YWl0IHVwbG9hZEltYWdlKHVwZGF0ZWRUYXNrLmltYWdlVXBsb2FkVXJsLCBzZWxlY3RlZEZpbGUpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvY2Vzc0ltYWdlKHVwZGF0ZWRUYXNrLnRhc2tJZCk7XG4gICAgICAgICAgc2V0TGFiZWxzKHJlc3VsdC5sYWJlbHMubWFwKChsYWJlbDogYW55KSA9PiBsYWJlbC5OYW1lKSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHByb2Nlc3NpbmcgaW1hZ2U6JywgZXJyKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBzZXRUYXNrKHVwZGF0ZWRUYXNrKTtcbiAgICAgIHNldE1lc3NhZ2UoJ+KchSBUYXNrIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5IScpO1xuICAgICAgc2V0RWRpdGluZyhmYWxzZSk7XG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICAgIHNldE1lc3NhZ2UoYOKdjCAke2Vyci5tZXNzYWdlfWApO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBzZXRTYXZpbmcoZmFsc2UpO1xuICAgIH1cbiAgfTtcblxuICBpZiAoIXRhc2spIHJldHVybiA8cD5Mb2FkaW5nIHRhc2suLi48L3A+O1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9XCJiZy13aGl0ZSBwLTYgcm91bmRlZCBzaGFkb3cgc3BhY2UteS00XCI+XG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPVwiZm9udC1zZW1pYm9sZFwiPlRhc2sgSUQ6PC9sYWJlbD5cbiAgICAgICAgPHA+e3Rhc2sudGFza0lkfTwvcD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPVwiZm9udC1zZW1pYm9sZFwiPlVzZXIgSUQ6PC9sYWJlbD5cbiAgICAgICAgPHA+e3Rhc2sudXNlcklkfTwvcD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPVwiZm9udC1zZW1pYm9sZFwiPlRpdGxlOjwvbGFiZWw+XG4gICAgICAgIHtlZGl0aW5nID8gKFxuICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgbmFtZT1cInRpdGxlXCJcbiAgICAgICAgICAgIHZhbHVlPXt0YXNrLnRpdGxlfVxuICAgICAgICAgICAgb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX1cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImJvcmRlciBwLTIgdy1mdWxsXCJcbiAgICAgICAgICAvPlxuICAgICAgICApIDogKFxuICAgICAgICAgIDxwPnt0YXNrLnRpdGxlfTwvcD5cbiAgICAgICAgKX1cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPVwiZm9udC1zZW1pYm9sZFwiPkRlc2NyaXB0aW9uOjwvbGFiZWw+XG4gICAgICAgIHtlZGl0aW5nID8gKFxuICAgICAgICAgIDx0ZXh0YXJlYVxuICAgICAgICAgICAgbmFtZT1cImRlc2NyaXB0aW9uXCJcbiAgICAgICAgICAgIHZhbHVlPXt0YXNrLmRlc2NyaXB0aW9ufVxuICAgICAgICAgICAgb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX1cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImJvcmRlciBwLTIgdy1mdWxsXCJcbiAgICAgICAgICAvPlxuICAgICAgICApIDogKFxuICAgICAgICAgIDxwPnt0YXNrLmRlc2NyaXB0aW9ufTwvcD5cbiAgICAgICAgKX1cbiAgICAgIDwvZGl2PlxuXG4gICAgICB7ZWRpdGluZyAmJiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwic3BhY2UteS0yXCI+XG4gICAgICAgICAgPGlucHV0IHR5cGU9XCJmaWxlXCIgYWNjZXB0PVwiaW1hZ2UvKlwiIG9uQ2hhbmdlPXtoYW5kbGVGaWxlQ2hhbmdlfSAvPlxuICAgICAgICAgIHtwcmV2aWV3VXJsICYmIDxpbWcgc3JjPXtwcmV2aWV3VXJsfSBhbHQ9XCJQcmV2aWV3XCIgY2xhc3NOYW1lPVwidy00OCByb3VuZGVkXCIgLz59XG4gICAgICAgIDwvZGl2PlxuICAgICAgKX1cblxuICAgICAge2VkaXRpbmcgPyAoXG4gICAgICAgIDxidXR0b24gb25DbGljaz17aGFuZGxlU2F2ZX0gZGlzYWJsZWQ9e3NhdmluZ30gY2xhc3NOYW1lPVwiYmctYmx1ZS02MDAgdGV4dC13aGl0ZSBweC00IHB5LTIgcm91bmRlZFwiPlxuICAgICAgICAgIHtzYXZpbmcgPyAnU2F2aW5nLi4uJyA6ICdTYXZlJ31cbiAgICAgICAgPC9idXR0b24+XG4gICAgICApIDogKFxuICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHNldEVkaXRpbmcodHJ1ZSl9IGNsYXNzTmFtZT1cImJnLWdyYXktMzAwIHRleHQtYmxhY2sgcHgtNCBweS0yIHJvdW5kZWRcIj5cbiAgICAgICAgICBFZGl0XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgKX1cblxuICAgICAge21lc3NhZ2UgJiYgPHAgY2xhc3NOYW1lPVwidGV4dC1zbSBtdC0yXCI+e21lc3NhZ2V9PC9wPn1cblxuICAgICAge2xhYmVscy5sZW5ndGggPiAwICYmIChcbiAgICAgICAgPGRpdj5cbiAgICAgICAgICA8aDMgY2xhc3NOYW1lPVwiZm9udC1zZW1pYm9sZCBtdC00XCI+RGV0ZWN0ZWQgTGFiZWxzOjwvaDM+XG4gICAgICAgICAgPHVsIGNsYXNzTmFtZT1cImxpc3QtZGlzYyBtbC02IHRleHQtc21cIj5cbiAgICAgICAgICAgIHtsYWJlbHMubWFwKGxhYmVsID0+IDxsaSBrZXk9e2xhYmVsfT57bGFiZWx9PC9saT4pfVxuICAgICAgICAgIDwvdWw+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKX1cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFRhc2tEZXRhaWw7Il19